<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COFFE TRADE PRO - Simulador Inteligente Caf√© 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #0f172a;
            --card: rgba(30, 41, 59, 0.85);
            --accent: #22c55e;
            --gold: #f59e0b;
            --profit: #10b981;
            --loss: #ef4444;
            --text: #e2e8f0;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: var(--bg); color: var(--text); font-family: system-ui, sans-serif; padding: 10px; min-height: 100vh; }
        .header { text-align: center; padding: 30px; background: linear-gradient(135deg, var(--accent), var(--gold)); border-radius: 24px; margin-bottom: 20px; }
        .title { font-size: 3rem; color: white; font-weight: bold; }
        .card { background: var(--card); backdrop-filter: blur(12px); border-radius: 20px; padding: 25px; margin: 20px 0; box-shadow: 0 12px 35px rgba(0,0,0,0.5); }
        .price-big { font-size: 4.5rem; text-align: center; font-weight: 900; background: linear-gradient(135deg, var(--accent), var(--gold)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .signal { font-size: 2.5rem; text-align: center; padding: 20px; border-radius: 20px; margin: 20px 0; font-weight: bold; }
        .buy-signal { background: rgba(34,197,94,0.3); color: var(--profit); }
        .sell-signal { background: rgba(239,68,68,0.3); color: var(--loss); }
        .hold-signal { background: rgba(251,191,36,0.3); color: var(--gold); }
        .btn { background: var(--accent); color: white; border: none; padding: 14px 28px; border-radius: 14px; font-size: 1.2rem; cursor: pointer; margin: 8px; box-shadow: 0 6px 18px rgba(34,197,94,0.4); transition: 0.3s; }
        .btn:hover { transform: translateY(-4px); }
        .input { padding: 12px; border-radius: 12px; border: none; margin: 10px; width: 220px; font-size: 1.1rem; }
        .result { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 16px; margin: 20px 0; line-height: 1.8; font-size: 1.2rem; }
        .chart-container { height: 450px; margin: 30px 0; }
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); justify-content: center; align-items: center; z-index: 1000; padding: 20px; }
        .modal-content { background: var(--card); border-radius: 24px; padding: 40px; max-width: 650px; text-align: center; }
        .emoji-big { font-size: 5.5rem; margin: 25px 0; }
        .investment-input { text-align: center; margin: 30px 0; }
        @media (max-width: 768px) { .price-big { font-size: 3rem; } .title { font-size: 2.4rem; } .chart-container { height: 350px; } }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="title">COFFE TRADE PRO 2026 ‚òï</h1>
        <p>Simulador Inteligente con Matem√°ticas Financieras - Te dice cu√°ndo COMPRAR o VENDER</p>
    </div>

    <div class="card investment-input">
        <h2>Ingresa tu capital para simular</h2>
        <input type="number" id="capital" class="input" placeholder="Tu dinero en USD (ej. 10000)" value="10000">
        <button class="btn" onclick="iniciarSimulacion()">Iniciar Simulaci√≥n Personal</button>
    </div>

    <div class="card">
        <h2>Precio Actual Caf√© Arabica</h2>
        <div class="price-big" id="price">$2.93 USD/lb</div>
        <button class="btn" onclick="actualizarTodo()">Calcular Todo (Matem√°ticas)</button>
    </div>

    <div class="card">
        <h2>Se√±al Inteligente (Basada en Matem√°ticas)</h2>
        <div class="signal" id="signal">Calculando...</div>
        <div class="result" id="explicacion"></div>
    </div>

    <div class="card">
        <h2>Gr√°fica Precios + Simulaci√≥n Monte Carlo</h2>
        <div class="chart-container">
            <canvas id="chart"></canvas>
        </div>
    </div>

    <div class="card">
        <h2>Tu Portafolio Simulado</h2>
        <div class="result" id="portafolio">Ingresa tu capital y calcula para ver.</div>
    </div>

    <div id="modal">
        <div class="modal-content">
            <h2>Consejo IA ‚òï</h2>
            <div class="emoji-big" id="modal-emoji"></div>
            <p id="modal-text"></p>
            <button class="btn" onclick="cerrarModal()">Cerrar</button>
        </div>
    </div>

    <script>
        let currentPrice = 2.93; // Real 11 feb 2026
        let capital = 10000;
        let posicion = { abierta: false, cantidad: 0, precioCompra: 0 };
        let plTotal = 0;
        let chart;

        const historical = [
            {date: 'Ene 2025', price: 3.80},
            {date: 'Abr 2025', price:0. 3.55},
            {date: 'Jul 2025', price: 3.30},
            {date: 'Oct 2025', price: 3.15},
            {date: 'Ene 2026', price: 3.05},
            {date: 'Feb 1', price: 3.00},
            {date: 'Feb 5', price: 2.97},
            {date: 'Feb 10', price: 2.94},
            {date: 'Hoy', price: currentPrice}
        ];

        function normCDF(x) {
            const t = 1 / (1 + 0.2316419 * Math.abs(x));
            const d = 0.39894228 * Math.exp(-x * x / 2);
            let prob = d * t * (0.31938153 + t * (-0.356563782 + t * (1.781477937 + t * (-1.821255978 + t * 1.330274429))));
            return x > 0 ? 1 - prob : prob;
        }

        function blackScholes(call, S, K, T, r, sigma) {
            const d1 = (Math.log(S / K) + (r + sigma * sigma / 2) * T) / (sigma * Math.sqrt(T));
            const d2 = d1 - sigma * Math.sqrt(T);
            if (call) return S * normCDF(d1) - K * Math.exp(-r * T) * normCDF(d2);
            return K * Math.exp(-r * T) * normCDF(-d2) - S * normCDF(-d1);
        }

        function monteCarlo(days = 90, sims = 2000) {
            const sigma = 0.35;
            const r = 0.04;
            const dt = 1 / 365;
            const finalPrices = [];

            for (let i = 0; i < sims; i++) {
                let price = currentPrice;
                for (let j = 0; j < days; j++) {
                    const z = Math.random() * 2 - 1;
                    price *= Math.exp((r - 0.5 * sigma * sigma) * dt + sigma * Math.sqrt(dt) * z);
                }
                finalPrices.push(price);
            }

            const avg = finalPrices.reduce((a, b) => a + b, 0) / sims;
            const probUp = finalPrices.filter(p => p > currentPrice).length / sims;
            return { avg, probUp };
        }

        function calcularVaR(confidence = 0.95, period = 30) {
            const sigma = 0.35;
            const z = 1.65; // 95%
            return currentPrice * sigma * Math.sqrt(period / 365) * z;
        }

        function generarSenal() {
            const mc = monteCarlo();
            const varRiesgo = calcularVaR();
            const callPrice = blackScholes(true, currentPrice, currentPrice * 1.05, 30/365, 0.04, 0.35); // Call 5% OTM

            let senal = 'HOLD';
            let explicacion = '';

            if (mc.probUp > 0.6 && varRiesgo < currentPrice * 0.2) {
                senal = 'COMPRAR';
                explicacion = `¬°COMPRA YA! Monte Carlo dice ${ (mc.probUp * 100).toFixed(0) }% probabilidad de subir. Riesgo bajo (VaR $${varRiesgo.toFixed(2)}). Como caf√© barato en la finca, hora de acumular.`;
            } else if (mc.probUp < 0.4 || callPrice < 0.05) {
                senal = 'VENDER';
                explicacion = `¬°VENDE! Probabilidad baja de subir (${ (mc.probUp * 100).toFixed(0) }%). Opciones baratas indican mercado bajista. Mejor asegurar la plata como buen cafetero.`;
            } else {
                senal = 'MANTENER';
                explicacion = `Mercado tranquilo como tinto en domingo. Probabilidad ${ (mc.probUp * 100).toFixed(0) }% de subir. Espera el momento perfecto.`;
            }

            document.getElementById('signal').innerText = senal;
            document.getElementById('signal').className = 'signal ' + (senal === 'COMPRAR' ? 'buy-signal' : senal === 'VENDER' ? 'sell-signal' : 'hold-signal');
            document.getElementById('explicacion').innerText = explicacion;
        }

        function iniciarSimulacion() {
            capital = parseFloat(document.getElementById('capital').value) || 10000;
            plTotal = 0;
            posicion = { abierta: false, cantidad: 0, precioCompra: 0 };
            actualizarTodo();
        }

        function actualizarTodo() {
            generarSenal();
            crearGrafica();
            actualizarPortafolio();
        }

        function crearGrafica() {
            const ctx = document.getElementById('chart').getContext('2d');
            if (chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: historical.map(h => h.date),
                    datasets: [{
                        label: 'Precio Real Caf√© USD/lb',
                        data: historical.map(h => h.price),
                        borderColor: '#22c55e',
                        backgroundColor: 'rgba(34,197,94,0.2)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: { responsive: true }
            });
        }

        function actualizarPortafolio() {
            if (posicion.abierta) {
                const valor = currentPrice * posicion.cantidad;
                const pl = valor - (posicion.precioCompra * posicion.cantidad);
                document.getElementById('portafolio').innerHTML = `
                    Capital inicial: $${capital.toFixed(0)} USD<br>
                    Posici√≥n: ${posicion.cantidad} lbs a $${posicion.precioCompra.toFixed(2)}<br>
                    Valor actual: $${valor.toFixed(0)} USD<br>
                    Ganancia/P√©rdida: $${pl.toFixed(0)} USD | Total portafolio: $${(capital + plTotal + pl).toFixed(0)} USD
                `;
            } else {
                document.getElementById('portafolio').innerHTML = `
                    Capital disponible: $${(capital + plTotal).toFixed(0)} USD<br>
                    Listo para invertir seg√∫n la se√±al matem√°tica.
                `;
            }
        }

        function comprar() {
            if (posicion.abierta) return;
            const cantidadMax = capital / currentPrice;
            const cantidad = Math.floor(cantidadMax / 100) * 100; // Redondeo pr√°ctico
            if (cantidad < 100) return;
            posicion = { abierta: true, cantidad, precioCompra: currentPrice };
            capital -= currentPrice * cantidad;
            actualizarPortafolio();
        }

        function vender() {
            if (!posicion.abierta) return;
            const pl = (currentPrice - posicion.precioCompra) * posicion.cantidad;
            plTotal += pl;
            capital += currentPrice * posicion.cantidad;
            posicion = { abierta: false, cantidad: 0, precioCompra: 0 };
            actualizarPortafolio();
        }

        function consultarIA() {
            const consejos = [
                {e: 'ü•≥', t: "¬°El precio est√° bajo como caf√© barato en la finca! Momento de COMPRAR seg√∫n Monte Carlo."},
                {e: '‚ö†Ô∏è', t: "Subiendo como r√≠o Cauca. Vende y asegura ganancia antes que baje, dice Black-Scholes."},
                {e: 'ü§ù', t: "Tranquilo como tinto en domingo. Mant√©n y observa las mates."}
            ];
            const c = consejos[Math.floor(Math.random() * consejos.length)];
            document.getElementById('modal-emoji').innerText = c.e;
            document.getElementById('modal-text').innerText = c.t;
            document.getElementById('modal').style.display = 'flex';
        }

        function cerrarModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // Inicio
        actualizarTodo();
    </script>
</body>
</html>
