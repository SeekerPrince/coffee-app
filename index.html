<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COFFE TRADE PRO - Trading Avanzado Caf√© 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #0f172a;
            --card: rgba(30, 41, 59, 0.85);
            --accent: #22c55e;
            --gold: #f59e0b;
            --profit: #10b981;
            --loss: #ef4444;
            --text: #e2e8f0;
            --text-light: #94a3b8;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: var(--bg); color: var(--text); font-family: system-ui, sans-serif; padding: 10px; min-height: 100vh; }
        .header { text-align: center; padding: 30px; background: linear-gradient(135deg, var(--accent), var(--gold)); border-radius: 24px; margin-bottom: 20px; }
        .title { font-size: 2.8rem; color: white; font-weight: bold; }
        .subtitle { color: rgba(255,255,255,0.9); font-size: 1.2rem; }
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .card { background: var(--card); backdrop-filter: blur(12px); border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid rgba(34,197,94,0.2); }
        .price-big { font-size: 4rem; text-align: center; font-weight: 900; background: linear-gradient(135deg, var(--accent), var(--gold)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .stat { font-size: 1.4rem; margin: 10px 0; }
        .change { padding: 10px; border-radius: 12px; font-weight: bold; }
        .profit { background: rgba(16,185,129,0.3); color: var(--profit); }
        .loss { background: rgba(239,68,68,0.3); color: var(--loss); }
        .btn { background: var(--accent); color: white; border: none; padding: 14px 28px; border-radius: 14px; font-size: 1.1rem; cursor: pointer; margin: 8px; box-shadow: 0 6px 18px rgba(34,197,94,0.4); transition: 0.3s; }
        .btn:hover { transform: translateY(-4px); }
        .btn-sell { background: var(--loss); box-shadow: 0 6px 18px rgba(239,68,68,0.4); }
        .trading-section { text-align: center; }
        .position-card { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 16px; margin: 20px 0; font-size: 1.3rem; }
        .chart-container { height: 450px; margin: 30px 0; }
        .trades-history { max-height: 300px; overflow-y: auto; margin-top: 20px; }
        .trade-item { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .news { font-size: 1.1rem; line-height: 1.6; }
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); justify-content: center; align-items: center; z-index: 1000; padding: 20px; }
        .modal-content { background: var(--card); border-radius: 24px; padding: 40px; max-width: 600px; text-align: center; }
        .emoji-big { font-size: 5rem; margin: 20px 0; }
        @media (max-width: 768px) { .price-big { font-size: 3rem; } .title { font-size: 2.2rem; } .dashboard { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="title">COFFE TRADE PRO 2026 ‚òï</h1>
        <p class="subtitle">Trading Avanzado Caf√© Arabica - Datos Reales desde Cali</p>
    </div>

    <div class="dashboard">
        <div class="card">
            <h2>Precio Actual</h2>
            <div class="price-big" id="price">$2.93</div>
            <div class="stat" id="change">Cargando...</div>
            <div class="stat">High: <span id="high">--</span> | Low: <span id="low">--</span></div>
            <div class="stat">Volumen: <span id="volume">--</span> | Open: <span id="open">--</span></div>
            <button class="btn" onclick="actualizarDatos()">Actualizar Mercado</button>
        </div>

        <div class="card">
            <h2>Noticias R√°pidas (Feb 2026)</h2>
            <div class="news">
                ‚Ä¢ Cosecha r√©cord Brasil (+17%): precios bajando.<br>
                ‚Ä¢ Clima ideal Colombia: buena calidad grano.<br>
                ‚Ä¢ Demanda Asia creciendo lento.<br>
                ‚Ä¢ Precio promedio feb: ~$2.90-2.95 USD/lb.
            </div>
        </div>
    </div>

    <div class="card">
        <h2>Gr√°fica Precios 2025-2026</h2>
        <div class="chart-container">
            <canvas id="priceChart"></canvas>
        </div>
    </div>

    <div class="card">
        <h2>Trading Simulado</h2>
        <div class="position-card" id="position">No tienes posici√≥n abierta.</div>
        <div class="trading-section">
            <input type="number" id="cantidad" placeholder="Cantidad lbs (ej. 1000)" value="1000" style="padding: 12px; border-radius: 12px; border: none; margin: 10px; width: 200px;">
            <button class="btn" onclick="comprar()">Comprar</button>
            <button class="btn btn-sell" onclick="vender()" id="sell-btn" disabled>Vender Todo</button>
            <button class="btn" onclick="consultarIA()">Consejo IA ‚òï</button>
        </div>
        <div class="trades-history" id="trades-history">
            <h3>Historial Trades</h3>
            <div id="trades-list">No hay trades a√∫n.</div>
        </div>
    </div>

    <div id="modal">
        <div class="modal-content">
            <h2>Consejo IA ‚òï</h2>
            <div class="emoji-big" id="modal-emoji"></div>
            <p id="modal-text"></p>
            <button class="btn" onclick="cerrarModal()">Cerrar</button>
        </div>
    </div>

    <script>
        const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
        let currentPrice = 2.93;
        let marketData = { high: 0, low: 0, change: 0, volume: 0, open: 0 };
        let posicion = { abierta: false, cantidad: 0, precioCompra: 0, pl: 0 };
        let trades = [];
        let chart;

        const historical = [
            {date: 'Ene 25', price: 3.80},
            {date: 'Abr 25', price: 3.50},
            {date: 'Jul 25', price: 3.20},
            {date: 'Oct 25', price: 3.10},
            {date: 'Ene 26', price: 3.00},
            {date: 'Feb 1', price: 2.98},
            {date: 'Feb 5', price: 2.95},
            {date: 'Feb 10', price: 2.94},
            {date: 'Hoy', price: currentPrice}
        ];

        function crearGrafica() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            if (chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: historical.map(h => h.date),
                    datasets: [{
                        label: 'Precio Caf√© USD/lb',
                        data: historical.map(h => h.price),
                        borderColor: '#22c55e',
                        backgroundColor: 'rgba(34,197,94,0.2)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { tooltip: { mode: 'index', intersect: false } },
                    scales: { y: { beginAtZero: false } }
                }
            });
        }

        async function actualizarDatos() {
            try {
                const url = CORS_PROXY + encodeURIComponent('https://query1.finance.yahoo.com/v8/finance/chart/KC=F?range=5d&interval=1d');
                const res = await fetch(url);
                const data = await res.json();
                const meta = data.chart.result[0].meta;
                const quotes = data.chart.result[0].indicators.quote[0];

                currentPrice = (meta.regularMarketPrice / 100).toFixed(2);
                marketData.high = (Math.max(...quotes.high) / 100).toFixed(2);
                marketData.low = (Math.min(...quotes.low.filter(v => v)) / 100).toFixed(2);
                marketData.volume = quotes.volume.reduce((a, b) => a + b, 0);
                marketData.open = (quotes.open[0] / 100).toFixed(2);
                marketData.change = ((currentPrice - marketData.open) / marketData.open * 100).toFixed(2);

                document.getElementById('price').innerText = `$${currentPrice}`;
                document.getElementById('high').innerText = marketData.high;
                document.getElementById('low').innerText = marketData.low;
                document.getElementById('volume').innerText = marketData.volume.toLocaleString();
                document.getElementById('open').innerText = marketData.open;
                const changeEl = document.getElementById('change');
                changeEl.innerText = `${marketData.change > 0 ? '+' : ''}${marketData.change}%`;
                changeEl.className = marketData.change > 0 ? 'change profit' : 'change loss';

                historical[historical.length - 1].price = parseFloat(currentPrice);
                crearGrafica();
                actualizarPosicion();
            } catch (e) {
                console.log('Fallback activo');
            }
        }

        function actualizarPosicion() {
            if (posicion.abierta) {
                const pl = (currentPrice - posicion.precioCompra) * posicion.cantidad;
                const pct = ((pl / (posicion.precioCompra * posicion.cantidad)) * 100).toFixed(2);
                document.getElementById('position').innerHTML = `
                    Posici√≥n abierta: ${posicion.cantidad} lbs @ $${posicion.precioCompra}<br>
                    Valor actual: $${(currentPrice * posicion.cantidad).toFixed(0)} USD<br>
                    P&L: <span style="color: ${pl >= 0 ? '#10b981' : '#ef4444'}">$${pl.toFixed(0)} USD (${pct}%)</span>
                `;
                document.getElementById('sell-btn').disabled = false;
            } else {
                document.getElementById('position').innerText = 'No tienes posici√≥n abierta.';
                document.getElementById('sell-btn').disabled = true;
            }
        }

        function comprar() {
            if (posicion.abierta) return;
            const cant = parseInt(document.getElementById('cantidad').value) || 1000;
            posicion = { abierta: true, cantidad: cant, precioCompra: currentPrice, pl: 0 };
            actualizarPosicion();
        }

        function vender() {
            if (!posicion.abierta) return;
            const pl = (currentPrice - posicion.precioCompra) * posicion.cantidad;
            trades.push({ tipo: 'Venta', cantidad: posicion.cantidad, precio: currentPrice, pl: pl.toFixed(0) });
            posicion.abierta = false;
            actualizarPosicion();
            actualizarHistorial();
        }

        function actualizarHistorial() {
            const list = document.getElementById('trades-list');
            if (trades.length === 0) {
                list.innerHTML = 'No hay trades a√∫n.';
                return;
            }
            list.innerHTML = trades.map(t => `
                <div class="trade-item">
                    ${t.tipo} ${t.cantidad} lbs @ $${t.precio} | P&L: $${t.pl} USD
                </div>
            `).join('');
        }

        function consultarIA() {
            const consejos = [
                {e: 'ü•≥', t: "Precio bajo como caf√© barato en la finca de Manizales. ¬°COMPRA y guarda para cuando suba!"},
                {e: '‚ö†Ô∏è', t: "Subiendo como el precio del tinto en diciembre. Si tienes, ¬°VENDE y asegura la plata!"},
                {e: 'ü§ù', t: "Mercado tranquilo como domingo en el Parque del Caf√©. Espera el momento perfecto."},
                {e: 'üö®', t: "Vol√°til como el clima en el Eje Cafetero. Pon cuidado con la cantidad."}
            ];
            const c = consejos[Math.floor(Math.random() * consejos.length)];
            document.getElementById('modal-emoji').innerText = c.e;
            document.getElementById('modal-text').innerText = c.t;
            document.getElementById('modal').style.display = 'flex';
        }

        function cerrarModal() {
            document.getElementById('modal').style.display = 'none';
        }

        actualizarDatos();
        setInterval(actualizarDatos, 20000);
        crearGrafica();
        actualizarPosicion();
    </script>
</body>
</html>
